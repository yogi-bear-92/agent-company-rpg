var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);const i={Tutorial:.5,Easy:1,Medium:1.5,Hard:2,Expert:3,Legendary:5},n={"Code Master":{Investigation:1.2,Creation:1.3},"Data Sage":{Investigation:1.3,Exploration:1.2},"Creative Bard":{Creation:1.3,Diplomacy:1.2},"Rapid Scout":{Exploration:1.3,Combat:1.2},"System Architect":{Creation:1.2,Training:1.3},"Bug Hunter":{Investigation:1.3,Combat:1.3},"Documentation Wizard":{Creation:1.2,Diplomacy:1.3}};function s(e){return Math.floor(100*Math.pow(1.5,e-1))}function a(e,t,s,a=0){let o=e.rewards.xp;o*=i[e.difficulty]||1;const r=n[t.class];if(r&&r[e.category]&&(o*=r[e.category]),s&&e.timeLimit){const t=s/e.timeLimit;t<.5?o*=1.5:t<.75?o*=1.25:t<1&&(o*=1.1)}const l=e.objectives.filter(e=>e.optional).length;if(l>0&&a>0){const t=a/l;o+=(e.bonusRewards?.xp||0)*t}if(e.assignedAgents.length>1){const t=1+.05*(e.assignedAgents.length-1);o*=Math.min(t,1.25)}const c=function(e){const t=e.realtimeActivity.filter(e=>e.xpGained&&e.xpGained>0);return t.length>=10?1.3:t.length>=5?1.15:t.length>=3?1.05:1}(t);return o*=c,Math.floor(o)}function o(e,t,i){const n=function(e){let t=1,i=e;for(;i>=s(t);)i-=s(t),t++;return{level:t,currentLevelXp:i,xpToNext:s(t)}}(e.xp+t),a=n.level>e.level,o={...e,xp:n.currentLevelXp,xpToNext:n.xpToNext,level:n.level,realtimeActivity:[{timestamp:(new Date).toISOString(),action:i,xpGained:t},...e.realtimeActivity.slice(0,49)]};if(a){o.stats=function(e,t){const i=Math.floor(t/5)+1;return{intelligence:e.intelligence+i,creativity:e.creativity+i,reliability:e.reliability+i,speed:e.speed+i,leadership:e.leadership+i}}(o.stats,n.level);const t=function(e,t){const i=[];5===e&&i.push("Advanced Analysis");10===e&&i.push("Master Coordination");15===e&&i.push("Expert Optimization");20===e&&i.push("Legendary Insight");const n={"Code Master":{3:"Refactoring Mastery",7:"Architecture Vision",12:"Performance Tuning",18:"System Integration"},"Data Sage":{3:"Pattern Recognition",7:"Predictive Analysis",12:"Data Synthesis",18:"Knowledge Fusion"},"Creative Bard":{3:"Narrative Weaving",7:"Design Harmony",12:"Innovation Spark",18:"Creative Revolution"},"Rapid Scout":{3:"Quick Navigation",7:"Parallel Processing",12:"Speed Optimization",18:"Instant Deployment"}}[t];n&&n[e]&&i.push(n[e]);return i}(n.level,e.class);return{updatedAgent:o,leveledUp:!0,newLevel:n.level,unlockedSkills:t}}return{updatedAgent:o,leveledUp:!1}}const r=new class{constructor(){t(this,"progressionState",{recentEvents:[],activeNotifications:[],levelUpQueue:[],isProcessing:!1}),t(this,"eventHandlers",{}),this.setupEventHandlers()}on(e,t){this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t)}emit(e){const t=this.eventHandlers[e.type];t&&t.forEach(t=>t(e)),this.progressionState.recentEvents.unshift(e),this.progressionState.recentEvents.length>100&&(this.progressionState.recentEvents=this.progressionState.recentEvents.slice(0,100))}async processXpGain(e,t,i){this.progressionState.isProcessing=!0;try{const n=o(e,t,i);let s;const a=[];return this.emit({type:"xp_gained",agentId:e.id,data:{amount:t,source:i,newTotal:n.updatedAgent.xp},timestamp:new Date}),n.leveledUp&&n.newLevel&&(s={agentId:e.id,oldLevel:e.level,newLevel:n.newLevel,xpGained:t,source:i,unlockedSkills:n.unlockedSkills||[],statIncreases:this.calculateStatIncreases(e.level,n.newLevel),timestamp:new Date},this.progressionState.levelUpQueue.push(s),a.push(this.createLevelUpNotification(s)),n.unlockedSkills&&n.unlockedSkills.forEach(t=>{a.push(this.createSkillUnlockNotification(e,t))}),this.emit({type:"level_up",agentId:e.id,data:s,timestamp:new Date})),a.forEach(e=>{this.progressionState.activeNotifications.push(e)}),{updatedAgent:n.updatedAgent,levelUpEvent:s,notifications:a}}finally{this.progressionState.isProcessing=!1}}async processQuestCompletion(e,t,i){const n=[],s=[],o=[];for(const r of t)if(e.assignedAgents.includes(r.id)){const t=a(e,r,i?.completionTime,i?.optionalObjectivesCompleted),l=i?.teamPerformanceBonus?Math.floor(t*i.teamPerformanceBonus):t,c=await this.processXpGain(r,l,`Quest: ${e.title}`);n.push(c.updatedAgent),c.levelUpEvent&&s.push(c.levelUpEvent),o.push(...c.notifications)}else n.push(r);return this.emit({type:"quest_completed",agentId:0,data:{quest:e,agents:e.assignedAgents,xpAwarded:!0},timestamp:new Date}),{updatedAgents:n,levelUpEvents:s,notifications:o}}calculateStatIncreases(e,t){const i=[];return t>=5&&e<5&&i.push({stat:"intelligence",amount:2,reason:"Novice Milestone"}),t>=10&&e<10&&(i.push({stat:"creativity",amount:3,reason:"Adept Milestone"}),i.push({stat:"leadership",amount:2,reason:"Leadership Awakening"})),t>=15&&e<15&&i.push({stat:"reliability",amount:3,reason:"Expert Milestone"}),t>=20&&e<20&&(i.push({stat:"speed",amount:4,reason:"Master Milestone"}),i.push({stat:"intelligence",amount:3,reason:"Wisdom of Masters"})),i}createLevelUpNotification(e){return{id:`levelup_${e.agentId}_${Date.now()}`,type:"level_up",title:"Level Up! 🎉",message:`Agent reached Level ${e.newLevel}!`,icon:"⬆️",priority:"high",duration:5e3,timestamp:new Date,dismissed:!1}}createSkillUnlockNotification(e,t){return{id:`skill_${e.id}_${t}_${Date.now()}`,type:"skill_unlock",title:"New Skill Unlocked! ✨",message:`${e.name} learned "${t}"`,icon:"🔓",priority:"medium",duration:4e3,timestamp:new Date,dismissed:!1}}getProgressionState(){return{...this.progressionState}}dismissNotification(e){const t=this.progressionState.activeNotifications.find(t=>t.id===e);t&&(t.dismissed=!0)}clearDismissedNotifications(){this.progressionState.activeNotifications=this.progressionState.activeNotifications.filter(e=>!e.dismissed)}getNextLevelUpEvent(){return this.progressionState.levelUpQueue.shift()}setupEventHandlers(){setInterval(()=>{const e=new Date;e.setHours(e.getHours()-24),this.progressionState.recentEvents=this.progressionState.recentEvents.filter(t=>t.timestamp>e),this.clearDismissedNotifications()},6e4)}};function l(e,t,i){return r.processXpGain(e,t,i)}function c(e,t,i){return r.processQuestCompletion(e,t,i)}export{c as a,r as l,l as p};
//# sourceMappingURL=utils-Bub4qm0q.js.map
